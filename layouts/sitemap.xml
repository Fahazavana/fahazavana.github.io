{{- /* Custom sitemap with multilingual support */ -}}
{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\"?>" | safeHTML -}}
{{- $cfg := .Site.Params.sitemap -}}
{{- $cf := or $cfg.changefreq "weekly" -}}
{{- $pr := or $cfg.priority 0.5 -}}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {{- /* Iterate all sites (languages); fallback to current site if .Sites unavailable */ -}}
  {{- range .Sites }}
    <url>
      <loc>{{ .BaseURL }}</loc>
      {{- $home := .Home -}}
      {{- if $home }}
        <xhtml:link rel="alternate" hreflang="{{ $home.Language.Lang }}" href="{{ $home.Permalink }}" />
        {{- range $home.Translations }}
          <xhtml:link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
        {{- end }}
      {{- end }}
      <changefreq>{{ $cf }}</changefreq>
      <priority>{{ $pr }}</priority>
    </url>
    {{- range .RegularPages }}
    <url>
      <loc>{{ .Permalink }}</loc>
      <xhtml:link rel="alternate" hreflang="{{ .Site.Language.Lang }}" href="{{ .Permalink }}" />
      {{- range .Translations }}
        <xhtml:link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
      {{- end }}
      {{- with .Lastmod }}<lastmod>{{ .Format "2006-01-02T15:04:05Z07:00" }}</lastmod>{{ end }}
      <changefreq>{{ $cf }}</changefreq>
      <priority>{{ $pr }}</priority>
    </url>
    {{- end }}
  {{- else }}
    <url>
      <loc>{{ .Site.BaseURL }}</loc>
      {{- $home := .Site.Home -}}
      {{- if $home }}
        <xhtml:link rel="alternate" hreflang="{{ $home.Language.Lang }}" href="{{ $home.Permalink }}" />
        {{- range $home.Translations }}
          <xhtml:link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
        {{- end }}
      {{- end }}
      <changefreq>{{ $cf }}</changefreq>
      <priority>{{ $pr }}</priority>
    </url>
    {{- range .Site.RegularPages }}
    <url>
      <loc>{{ .Permalink }}</loc>
      <xhtml:link rel="alternate" hreflang="{{ .Site.Language.Lang }}" href="{{ .Permalink }}" />
      {{- range .Translations }}
        <xhtml:link rel="alternate" hreflang="{{ .Language.Lang }}" href="{{ .Permalink }}" />
      {{- end }}
      {{- with .Lastmod }}<lastmod>{{ .Format "2006-01-02T15:04:05Z07:00" }}</lastmod>{{ end }}
      <changefreq>{{ $cf }}</changefreq>
      <priority>{{ $pr }}</priority>
    </url>
    {{- end }}
  {{- end }}
</urlset>
